<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_25) on Fri Feb 28 14:19:11 PST 2014 -->
<meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
<title>ReplicationSourceManager (HBase 0.96.1.1-cdh5.0.0-SNAPSHOT API)</title>
<meta name="date" content="2014-02-28">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="ReplicationSourceManager (HBase 0.96.1.1-cdh5.0.0-SNAPSHOT API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/ReplicationSourceManager.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.html" title="interface in org.apache.hadoop.hbase.replication.regionserver"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSyncUp.html" title="class in org.apache.hadoop.hbase.replication.regionserver"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html" target="_top">Frames</a></li>
<li><a href="ReplicationSourceManager.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.hadoop.hbase.replication.regionserver</div>
<h2 title="Class ReplicationSourceManager" class="title">Class ReplicationSourceManager</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li>org.apache.hadoop.hbase.replication.regionserver.ReplicationSourceManager</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationListener.html" title="interface in org.apache.hadoop.hbase.replication">ReplicationListener</a></dd>
</dl>
<hr>
<br>
<pre>@InterfaceAudience.Private
public class <span class="strong">ReplicationSourceManager</span>
extends <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>
implements <a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationListener.html" title="interface in org.apache.hadoop.hbase.replication">ReplicationListener</a></pre>
<div class="block">This class is responsible to manage all the replication
 sources. There are two classes of sources:
 <li> Normal sources are persistent and one per peer cluster</li>
 <li> Old sources are recovered from a failed region server and our
 only goal is to finish replicating the HLog queue it had up in ZK</li>

 When a region server dies, this class uses a watcher to get notified and it
 tries to grab a lock in order to transfer all the queues in a local
 old source.

 This class implements the ReplicationListener interface so that it can track changes in
 replication state.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#ReplicationSourceManager(org.apache.hadoop.hbase.replication.ReplicationQueues, org.apache.hadoop.hbase.replication.ReplicationPeers, org.apache.hadoop.hbase.replication.ReplicationTracker, org.apache.hadoop.conf.Configuration, org.apache.hadoop.hbase.Stoppable, org.apache.hadoop.fs.FileSystem, org.apache.hadoop.fs.Path, org.apache.hadoop.fs.Path, java.util.UUID)">ReplicationSourceManager</a></strong>(<a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationQueues.html" title="interface in org.apache.hadoop.hbase.replication">ReplicationQueues</a>&nbsp;replicationQueues,
                        <a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationPeers.html" title="interface in org.apache.hadoop.hbase.replication">ReplicationPeers</a>&nbsp;replicationPeers,
                        <a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationTracker.html" title="interface in org.apache.hadoop.hbase.replication">ReplicationTracker</a>&nbsp;replicationTracker,
                        org.apache.hadoop.conf.Configuration&nbsp;conf,
                        <a href="../../../../../../org/apache/hadoop/hbase/Stoppable.html" title="interface in org.apache.hadoop.hbase">Stoppable</a>&nbsp;stopper,
                        org.apache.hadoop.fs.FileSystem&nbsp;fs,
                        org.apache.hadoop.fs.Path&nbsp;logDir,
                        org.apache.hadoop.fs.Path&nbsp;oldLogDir,
                        <a href="http://docs.oracle.com/javase/6/docs/api/java/util/UUID.html?is-external=true" title="class or interface in java.util">UUID</a>&nbsp;clusterId)</code>
<div class="block">Creates a replication manager and sets the watch on all the other registered region servers</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected <a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.html" title="interface in org.apache.hadoop.hbase.replication.regionserver">ReplicationSourceInterface</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#addSource(java.lang.String)">addSource</a></strong>(<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;id)</code>
<div class="block">Add a new normal source to this region server</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#cleanOldLogs(java.lang.String, java.lang.String, boolean)">cleanOldLogs</a></strong>(<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;key,
            <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;id,
            boolean&nbsp;queueRecovered)</code>
<div class="block">Cleans a log file and all older files from ZK.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#closeRecoveredQueue(org.apache.hadoop.hbase.replication.regionserver.ReplicationSourceInterface)">closeRecoveredQueue</a></strong>(<a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.html" title="interface in org.apache.hadoop.hbase.replication.regionserver">ReplicationSourceInterface</a>&nbsp;src)</code>
<div class="block">Clear the references to the specified old source</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#deleteSource(java.lang.String, boolean)">deleteSource</a></strong>(<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;peerId,
            boolean&nbsp;closeConnection)</code>
<div class="block">Delete a complete queue of hlogs associated with a peer cluster</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>org.apache.hadoop.fs.FileSystem</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#getFs()">getFs</a></strong>()</code>
<div class="block">Get the handle on the local file system</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected <a href="http://docs.oracle.com/javase/6/docs/api/java/util/Map.html?is-external=true" title="class or interface in java.util">Map</a>&lt;<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>,<a href="http://docs.oracle.com/javase/6/docs/api/java/util/SortedSet.html?is-external=true" title="class or interface in java.util">SortedSet</a>&lt;<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&gt;&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#getHLogs()">getHLogs</a></strong>()</code>
<div class="block">Get a copy of the hlogs of the first source on this rs</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>org.apache.hadoop.fs.Path</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#getLogDir()">getLogDir</a></strong>()</code>
<div class="block">Get the directory where hlogs are stored by their RSs</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>org.apache.hadoop.fs.Path</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#getOldLogDir()">getOldLogDir</a></strong>()</code>
<div class="block">Get the directory where hlogs are archived</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.html" title="interface in org.apache.hadoop.hbase.replication.regionserver">ReplicationSourceInterface</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#getOldSources()">getOldSources</a></strong>()</code>
<div class="block">Get a list of all the old sources of this rs</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected <a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.html" title="interface in org.apache.hadoop.hbase.replication.regionserver">ReplicationSourceInterface</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#getReplicationSource(org.apache.hadoop.conf.Configuration, org.apache.hadoop.fs.FileSystem, org.apache.hadoop.hbase.replication.regionserver.ReplicationSourceManager, org.apache.hadoop.hbase.replication.ReplicationQueues, org.apache.hadoop.hbase.replication.ReplicationPeers, org.apache.hadoop.hbase.Stoppable, java.lang.String, java.util.UUID)">getReplicationSource</a></strong>(org.apache.hadoop.conf.Configuration&nbsp;conf,
                    org.apache.hadoop.fs.FileSystem&nbsp;fs,
                    <a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html" title="class in org.apache.hadoop.hbase.replication.regionserver">ReplicationSourceManager</a>&nbsp;manager,
                    <a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationQueues.html" title="interface in org.apache.hadoop.hbase.replication">ReplicationQueues</a>&nbsp;replicationQueues,
                    <a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationPeers.html" title="interface in org.apache.hadoop.hbase.replication">ReplicationPeers</a>&nbsp;replicationPeers,
                    <a href="../../../../../../org/apache/hadoop/hbase/Stoppable.html" title="interface in org.apache.hadoop.hbase">Stoppable</a>&nbsp;stopper,
                    <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;peerId,
                    <a href="http://docs.oracle.com/javase/6/docs/api/java/util/UUID.html?is-external=true" title="class or interface in java.util">UUID</a>&nbsp;clusterId)</code>
<div class="block">Factory method to create a replication source</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.html" title="interface in org.apache.hadoop.hbase.replication.regionserver">ReplicationSourceInterface</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#getSources()">getSources</a></strong>()</code>
<div class="block">Get a list of all the normal sources of this rs</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#getStats()">getStats</a></strong>()</code>
<div class="block">Get a string representation of all the sources' metrics</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#init()">init</a></strong>()</code>
<div class="block">Adds a normal source per registered peer cluster and tries to process all
 old region server hlog queues</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#join()">join</a></strong>()</code>
<div class="block">Terminate the replication on this region server</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#logPositionAndCleanOldLogs(org.apache.hadoop.fs.Path, java.lang.String, long, boolean, boolean)">logPositionAndCleanOldLogs</a></strong>(org.apache.hadoop.fs.Path&nbsp;log,
                          <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;id,
                          long&nbsp;position,
                          boolean&nbsp;queueRecovered,
                          boolean&nbsp;holdLogInZK)</code>
<div class="block">Provide the id of the peer and a log key and this method will figure which
 hlog it belongs to and will log, for this region server, the current
 position.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#peerListChanged(java.util.List)">peerListChanged</a></strong>(<a href="http://docs.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&gt;&nbsp;peerIds)</code>
<div class="block">The list of registered peer clusters has changed.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#peerRemoved(java.lang.String)">peerRemoved</a></strong>(<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;peerId)</code>
<div class="block">A peer cluster has been removed (i.e.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#regionServerRemoved(java.lang.String)">regionServerRemoved</a></strong>(<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;regionserver)</code>
<div class="block">A region server has been removed from the local cluster</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html#removePeer(java.lang.String)">removePeer</a></strong>(<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;id)</code>
<div class="block">Thie method first deletes all the recovered sources for the specified
 id, then deletes the normal source (deleting all related data in ZK).</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#clone()" title="class or interface in java.lang">clone</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#equals(java.lang.Object)" title="class or interface in java.lang">equals</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#finalize()" title="class or interface in java.lang">finalize</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#getClass()" title="class or interface in java.lang">getClass</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#hashCode()" title="class or interface in java.lang">hashCode</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notify()" title="class or interface in java.lang">notify</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notifyAll()" title="class or interface in java.lang">notifyAll</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#toString()" title="class or interface in java.lang">toString</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait()" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long)" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long, int)" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="ReplicationSourceManager(org.apache.hadoop.hbase.replication.ReplicationQueues, org.apache.hadoop.hbase.replication.ReplicationPeers, org.apache.hadoop.hbase.replication.ReplicationTracker, org.apache.hadoop.conf.Configuration, org.apache.hadoop.hbase.Stoppable, org.apache.hadoop.fs.FileSystem, org.apache.hadoop.fs.Path, org.apache.hadoop.fs.Path, java.util.UUID)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>ReplicationSourceManager</h4>
<pre>public&nbsp;ReplicationSourceManager(<a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationQueues.html" title="interface in org.apache.hadoop.hbase.replication">ReplicationQueues</a>&nbsp;replicationQueues,
                        <a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationPeers.html" title="interface in org.apache.hadoop.hbase.replication">ReplicationPeers</a>&nbsp;replicationPeers,
                        <a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationTracker.html" title="interface in org.apache.hadoop.hbase.replication">ReplicationTracker</a>&nbsp;replicationTracker,
                        org.apache.hadoop.conf.Configuration&nbsp;conf,
                        <a href="../../../../../../org/apache/hadoop/hbase/Stoppable.html" title="interface in org.apache.hadoop.hbase">Stoppable</a>&nbsp;stopper,
                        org.apache.hadoop.fs.FileSystem&nbsp;fs,
                        org.apache.hadoop.fs.Path&nbsp;logDir,
                        org.apache.hadoop.fs.Path&nbsp;oldLogDir,
                        <a href="http://docs.oracle.com/javase/6/docs/api/java/util/UUID.html?is-external=true" title="class or interface in java.util">UUID</a>&nbsp;clusterId)</pre>
<div class="block">Creates a replication manager and sets the watch on all the other registered region servers</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>replicationQueues</code> - the interface for manipulating replication queues</dd><dd><code>replicationPeers</code> - </dd><dd><code>replicationTracker</code> - </dd><dd><code>conf</code> - the configuration to use</dd><dd><code>stopper</code> - the stopper object for this region server</dd><dd><code>fs</code> - the file system to use</dd><dd><code>logDir</code> - the directory that contains all hlog directories of live RSs</dd><dd><code>oldLogDir</code> - the directory where old logs are archived</dd><dd><code>clusterId</code> - </dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="logPositionAndCleanOldLogs(org.apache.hadoop.fs.Path, java.lang.String, long, boolean, boolean)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>logPositionAndCleanOldLogs</h4>
<pre>public&nbsp;void&nbsp;logPositionAndCleanOldLogs(org.apache.hadoop.fs.Path&nbsp;log,
                              <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;id,
                              long&nbsp;position,
                              boolean&nbsp;queueRecovered,
                              boolean&nbsp;holdLogInZK)</pre>
<div class="block">Provide the id of the peer and a log key and this method will figure which
 hlog it belongs to and will log, for this region server, the current
 position. It will also clean old logs from the queue.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>log</code> - Path to the log currently being replicated from
 replication status in zookeeper. It will also delete older entries.</dd><dd><code>id</code> - id of the peer cluster</dd><dd><code>position</code> - current location in the log</dd><dd><code>queueRecovered</code> - indicates if this queue comes from another region server</dd><dd><code>holdLogInZK</code> - if true then the log is retained in ZK</dd></dl>
</li>
</ul>
<a name="cleanOldLogs(java.lang.String, java.lang.String, boolean)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>cleanOldLogs</h4>
<pre>public&nbsp;void&nbsp;cleanOldLogs(<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;key,
                <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;id,
                boolean&nbsp;queueRecovered)</pre>
<div class="block">Cleans a log file and all older files from ZK. Called when we are sure that a
 log file is closed and has no more entries.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>key</code> - Path to the log</dd><dd><code>id</code> - id of the peer cluster</dd><dd><code>queueRecovered</code> - Whether this is a recovered queue</dd></dl>
</li>
</ul>
<a name="init()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>init</h4>
<pre>protected&nbsp;void&nbsp;init()
             throws <a href="http://docs.oracle.com/javase/6/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a>,
                    <a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationException.html" title="class in org.apache.hadoop.hbase.replication">ReplicationException</a></pre>
<div class="block">Adds a normal source per registered peer cluster and tries to process all
 old region server hlog queues</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/6/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code></dd>
<dd><code><a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationException.html" title="class in org.apache.hadoop.hbase.replication">ReplicationException</a></code></dd></dl>
</li>
</ul>
<a name="addSource(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>addSource</h4>
<pre>protected&nbsp;<a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.html" title="interface in org.apache.hadoop.hbase.replication.regionserver">ReplicationSourceInterface</a>&nbsp;addSource(<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;id)
                                        throws <a href="http://docs.oracle.com/javase/6/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a>,
                                               <a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationException.html" title="class in org.apache.hadoop.hbase.replication">ReplicationException</a></pre>
<div class="block">Add a new normal source to this region server</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>id</code> - the id of the peer cluster</dd>
<dt><span class="strong">Returns:</span></dt><dd>the source that was created</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/6/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code></dd>
<dd><code><a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationException.html" title="class in org.apache.hadoop.hbase.replication">ReplicationException</a></code></dd></dl>
</li>
</ul>
<a name="deleteSource(java.lang.String, boolean)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>deleteSource</h4>
<pre>public&nbsp;void&nbsp;deleteSource(<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;peerId,
                boolean&nbsp;closeConnection)</pre>
<div class="block">Delete a complete queue of hlogs associated with a peer cluster</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>peerId</code> - Id of the peer cluster queue of hlogs to delete</dd></dl>
</li>
</ul>
<a name="join()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>join</h4>
<pre>public&nbsp;void&nbsp;join()</pre>
<div class="block">Terminate the replication on this region server</div>
</li>
</ul>
<a name="getHLogs()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getHLogs</h4>
<pre>protected&nbsp;<a href="http://docs.oracle.com/javase/6/docs/api/java/util/Map.html?is-external=true" title="class or interface in java.util">Map</a>&lt;<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>,<a href="http://docs.oracle.com/javase/6/docs/api/java/util/SortedSet.html?is-external=true" title="class or interface in java.util">SortedSet</a>&lt;<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&gt;&gt;&nbsp;getHLogs()</pre>
<div class="block">Get a copy of the hlogs of the first source on this rs</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>a sorted set of hlog names</dd></dl>
</li>
</ul>
<a name="getSources()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getSources</h4>
<pre>public&nbsp;<a href="http://docs.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.html" title="interface in org.apache.hadoop.hbase.replication.regionserver">ReplicationSourceInterface</a>&gt;&nbsp;getSources()</pre>
<div class="block">Get a list of all the normal sources of this rs</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>lis of all sources</dd></dl>
</li>
</ul>
<a name="getOldSources()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getOldSources</h4>
<pre>public&nbsp;<a href="http://docs.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.html" title="interface in org.apache.hadoop.hbase.replication.regionserver">ReplicationSourceInterface</a>&gt;&nbsp;getOldSources()</pre>
<div class="block">Get a list of all the old sources of this rs</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>list of all old sources</dd></dl>
</li>
</ul>
<a name="getReplicationSource(org.apache.hadoop.conf.Configuration, org.apache.hadoop.fs.FileSystem, org.apache.hadoop.hbase.replication.regionserver.ReplicationSourceManager, org.apache.hadoop.hbase.replication.ReplicationQueues, org.apache.hadoop.hbase.replication.ReplicationPeers, org.apache.hadoop.hbase.Stoppable, java.lang.String, java.util.UUID)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getReplicationSource</h4>
<pre>protected&nbsp;<a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.html" title="interface in org.apache.hadoop.hbase.replication.regionserver">ReplicationSourceInterface</a>&nbsp;getReplicationSource(org.apache.hadoop.conf.Configuration&nbsp;conf,
                                              org.apache.hadoop.fs.FileSystem&nbsp;fs,
                                              <a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html" title="class in org.apache.hadoop.hbase.replication.regionserver">ReplicationSourceManager</a>&nbsp;manager,
                                              <a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationQueues.html" title="interface in org.apache.hadoop.hbase.replication">ReplicationQueues</a>&nbsp;replicationQueues,
                                              <a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationPeers.html" title="interface in org.apache.hadoop.hbase.replication">ReplicationPeers</a>&nbsp;replicationPeers,
                                              <a href="../../../../../../org/apache/hadoop/hbase/Stoppable.html" title="interface in org.apache.hadoop.hbase">Stoppable</a>&nbsp;stopper,
                                              <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;peerId,
                                              <a href="http://docs.oracle.com/javase/6/docs/api/java/util/UUID.html?is-external=true" title="class or interface in java.util">UUID</a>&nbsp;clusterId)
                                                   throws <a href="http://docs.oracle.com/javase/6/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Factory method to create a replication source</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>conf</code> - the configuration to use</dd><dd><code>fs</code> - the file system to use</dd><dd><code>manager</code> - the manager to use</dd><dd><code>stopper</code> - the stopper object for this region server</dd><dd><code>peerId</code> - the id of the peer cluster</dd>
<dt><span class="strong">Returns:</span></dt><dd>the created source</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/6/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code></dd></dl>
</li>
</ul>
<a name="closeRecoveredQueue(org.apache.hadoop.hbase.replication.regionserver.ReplicationSourceInterface)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>closeRecoveredQueue</h4>
<pre>public&nbsp;void&nbsp;closeRecoveredQueue(<a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.html" title="interface in org.apache.hadoop.hbase.replication.regionserver">ReplicationSourceInterface</a>&nbsp;src)</pre>
<div class="block">Clear the references to the specified old source</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>src</code> - source to clear</dd></dl>
</li>
</ul>
<a name="removePeer(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>removePeer</h4>
<pre>public&nbsp;void&nbsp;removePeer(<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;id)</pre>
<div class="block">Thie method first deletes all the recovered sources for the specified
 id, then deletes the normal source (deleting all related data in ZK).</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>id</code> - The id of the peer cluster</dd></dl>
</li>
</ul>
<a name="regionServerRemoved(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>regionServerRemoved</h4>
<pre>public&nbsp;void&nbsp;regionServerRemoved(<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;regionserver)</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationListener.html#regionServerRemoved(java.lang.String)">ReplicationListener</a></code></strong></div>
<div class="block">A region server has been removed from the local cluster</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationListener.html#regionServerRemoved(java.lang.String)">regionServerRemoved</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationListener.html" title="interface in org.apache.hadoop.hbase.replication">ReplicationListener</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>regionserver</code> - the removed region server</dd></dl>
</li>
</ul>
<a name="peerRemoved(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>peerRemoved</h4>
<pre>public&nbsp;void&nbsp;peerRemoved(<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;peerId)</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationListener.html#peerRemoved(java.lang.String)">ReplicationListener</a></code></strong></div>
<div class="block">A peer cluster has been removed (i.e. unregistered) from replication.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationListener.html#peerRemoved(java.lang.String)">peerRemoved</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationListener.html" title="interface in org.apache.hadoop.hbase.replication">ReplicationListener</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>peerId</code> - The peer id of the cluster that has been removed</dd></dl>
</li>
</ul>
<a name="peerListChanged(java.util.List)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>peerListChanged</h4>
<pre>public&nbsp;void&nbsp;peerListChanged(<a href="http://docs.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&gt;&nbsp;peerIds)</pre>
<div class="block"><strong>Description copied from interface:&nbsp;<code><a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationListener.html#peerListChanged(java.util.List)">ReplicationListener</a></code></strong></div>
<div class="block">The list of registered peer clusters has changed.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationListener.html#peerListChanged(java.util.List)">peerListChanged</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../../org/apache/hadoop/hbase/replication/ReplicationListener.html" title="interface in org.apache.hadoop.hbase.replication">ReplicationListener</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>peerIds</code> - A list of all currently registered peer clusters</dd></dl>
</li>
</ul>
<a name="getOldLogDir()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getOldLogDir</h4>
<pre>public&nbsp;org.apache.hadoop.fs.Path&nbsp;getOldLogDir()</pre>
<div class="block">Get the directory where hlogs are archived</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>the directory where hlogs are archived</dd></dl>
</li>
</ul>
<a name="getLogDir()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getLogDir</h4>
<pre>public&nbsp;org.apache.hadoop.fs.Path&nbsp;getLogDir()</pre>
<div class="block">Get the directory where hlogs are stored by their RSs</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>the directory where hlogs are stored by their RSs</dd></dl>
</li>
</ul>
<a name="getFs()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getFs</h4>
<pre>public&nbsp;org.apache.hadoop.fs.FileSystem&nbsp;getFs()</pre>
<div class="block">Get the handle on the local file system</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>Handle on the local file system</dd></dl>
</li>
</ul>
<a name="getStats()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>getStats</h4>
<pre>public&nbsp;<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;getStats()</pre>
<div class="block">Get a string representation of all the sources' metrics</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/ReplicationSourceManager.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.html" title="interface in org.apache.hadoop.hbase.replication.regionserver"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../../org/apache/hadoop/hbase/replication/regionserver/ReplicationSyncUp.html" title="class in org.apache.hadoop.hbase.replication.regionserver"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.html" target="_top">Frames</a></li>
<li><a href="ReplicationSourceManager.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2014 <a href="http://www.cloudera.com">Cloudera</a>. All rights reserved.</small></p>
</body>
</html>
